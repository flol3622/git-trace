# typst-git-info

Typst package for reading basic Git metadata. It reads `HEAD` and `refs` directly and can also load commit message/date from a small TOML file generated by `git log`.

## Usage

```typst
#import "src/lib.typ": git-branch, git-head-hash, git-last-commit, git-log

#let branch = git-branch()
#let hash = git-head-hash()
#let last = git-last-commit(meta_path: "git-meta.toml")

branch: #branch \
head: #hash \
last message: #last.message \
last date: #last.date
```

## Generate commit metadata (message/date)

Typst cannot read commit messages/dates from `.git` without external help. Generate a small TOML file before compiling:

```sh
git log -1 --date=iso-strict --format='hash = "%H"%nmessage = "%s"%ndate = "%cI"%n' > git-meta.toml
```

PowerShell variant:

```powershell
git log -1 --date=iso-strict --format='hash = "%H"`nmessage = "%s"`ndate = "%cI"`n' | Set-Content -NoNewline git-meta.toml
```

## Parse a commit list

If you export a list of commits as `hash|date|message`, you can parse it with `git-log`:

```sh
git log -5 --date=iso-strict --format='%H|%cI|%s' > git-log.txt
```

```typst
#let commits = git-log("git-log.txt")
#commits.first()
```

## Notes

- `git-head-hash` reads `.git/HEAD` and `.git/refs/...` directly. If your repository uses packed refs only, you may need to run `git pack-refs --no-prune` once to keep loose refs.
- The package reads files; it does not run Git commands or modify the repository.